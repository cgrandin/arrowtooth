# Bridging analysis

The base model from the 2015 assessment was run with the newest version of the iSCAM code and the original data files and the results were determined to be identical.

Various modifications were made incrementally to the 2015 base model to create a set of bridging models which evaluate the component-specific effects of all changes from the 2015 base model to the 2021 base model.

As a reminder, the 2015 base model was a female-only catch-at-age model with 4 indices of abundance which included the three Synoptic surveys and the Hecate Strait Multispecies assemblage survey.

The bridging models were constructed in several steps and are compared in the following subsections.

## Single-fleet female only models

The models in this section were produced as follows. Each model is a copy of the previous one with only one change made so incremental changes can be easily tracked.


1. Extracted the data used in the 2015 model using the **gfplot** package, which has been used in several assessments and in the **gfsynopsis** report. Ran the 2015 model without any modifications other than this data change.

1. Using the same data extraction methods as in the first step, appended data up to and including 2019.

1. Attempted to add the West Coast Haida Gwaii Synoptic survey (WCHGSS) but the model fails to estimate trawl selectivity when both the Hecate Strait Multispecies Assemblage survey (HSMAS) and the WCHGSS are included, so the WCHGSS was left out due to its limited area and years of coverage and because the HSMAS covers the early period of the time series.

1. Added the Discard CPUE index. This was suggested by the Technical Working Group (TWG) and is an index for vessels that were not fishing for `r sp` and therefore were discarding all that they caught incidentally. The selectivity could not reliably be estimated for this index in the current model configuration, so its selectivity was set to mirror that of the trawl fishery (Table \@ref(tab:bridge1-sel-param-table)). This decision was based on the Discard CPUE being directly extracted from the trawl fishery data. The Discard CPUE index is described in greater detail in later sections.

(ref:fig-bridge1-biomass) Maximum Posterior Density (MPD) estimates of spawning biomass (top panel) and relative spawning biomass (bottom panel) for the 2015 base model and models with cumulative changes to that model including data changes and additions, and the addition of the Discard CPUE index.

(ref:fig-bridge1-biomass-french) French caption here

```{r bridge1-biomass, fig.cap = ifelse(french, "(ref:fig-bridge1-biomass-french)", "(ref:fig-bridge1-biomass)"), out.width = "100%" , fig.pos="H"}
cowplot::plot_grid(plot_ts_mpd(models$bridge_models[[1]], type = "sbt", legend_title = "Bridge models - 1 fleet, 1 sex"),
                   plot_ts_mpd(models$bridge_models[[1]], type = "sbt", rel = TRUE, legend_title = "Bridge models - 1 fleet, 1 sex") + 
                     coord_cartesian(ylim = c(0, 1)), nrow = 2)
                   
```

(ref:fig-bridge1-recruitment) Maximum Posterior Density (MPD) estimates of recruitment for the 2015 base model and models with cumulative changes to that model including data changes and additions, and the addition of the Discard CPUE index.

(ref:fig-bridge1-recruitment-french) French caption here

```{r bridge1-recruitment, fig.cap = ifelse(french, "(ref:fig-bridge1-recruitment-french)", "(ref:fig-bridge1-recruitment)"), out.width = "100%" , fig.pos="H"}
plot_ts_mpd(models$bridge_models[[1]], type = "rt", legend_title = "Bridge models - 1 fleet, 1 sex") +
  coord_cartesian(ylim = c(0, 1.5))
```

(ref:fig-bridge1-index-fits) Maximum Posterior Density (MPD) index fits for the 2015 base model and models with cumulative changes to that model including data changes and additions, and the addition of the Discard CPUE index.

(ref:fig-bridge1-index-fits-french) French caption here

```{r bridge1-index-fits, fig.cap = ifelse(french, "(ref:fig-bridge1-index-fits-french)", "(ref:fig-bridge1-index-fits)"), out.width = "100%" , fig.pos="H"}
plot_index_fit_mpd(models$bridge_models[[1]], surv_index = survey_index, legend_title = "Bridge models - 1 fleet, 1 sex")
```

\clearpage

```{r bridge1-param-settings-table, results = 'asis'}
param_settings_table(
  models$bridge_models[[1]][[1]],
  format = "latex",
  font_size = 7,
  caption = ifelse(
    french,
    "French goes here",
    "Number of parameters estimated, bounds, and prior parameterizations for the model '2015 Base model'."))
```

```{r bridge1-param-table, results = 'asis'}
param_est_mpd_table(
  models$bridge_models[[1]],
  format = "latex",
  digits = 3,
  font_size = 7,
  model_col_widths = "5em",
  caption = ifelse(
    french,
    "French goes here",
    "Bridge model parameter estimates for the primary parameters, reference points, and catchability estimates ($q$) for each index.")) 
```

\clearpage

(ref:fig-bridge1-selectivities) Maximum Posterior Density (MPD) maturity ogives and selectivity estimates for all gears in the models with one fleets and one sex. The dashed red line is the female maturity ogive, the red lines with points is the yearly selectivity estimate for females.

```{r bridge1-selectivities, fig.cap = "(ref:fig-bridge1-selectivities)"}
library(gridExtra)
plist <- map2(models$bridge_models[[1]], names(models$bridge_models[[1]]), ~{
  plot_selex(.x, show_maturity = TRUE, title = .y) +
    theme(plot.title = element_text(face = "bold", size = 12),
          axis.text.x = element_text(size = 6),
          strip.text.x = element_text(size = 6))
})
n <- length(plist)
nrow <- floor(sqrt(n))
do.call("grid.arrange", c(plist, ncol = nrow))
```

```{r bridge1-sel-param-table, results = 'asis'}
sel_param_est_mpd_table(
  models$bridge_models[[1]],
  format = "latex",
  digits = 3,
  font_size = 7,
  model_col_widths = "5em",
  caption = ifelse(
    french,
    "French goes here",
    "A comparison of Bridge model selectivity parameter estimates. The number in parentheses in the 'Type' column represents the iSCAM code for the type of selectivity used. For example, a Logistic selectivity can have type '1' or '6'. The '6' allows for fixing the selectivity parameters. In the 'Fixed' column all blank entries are estimated parameters, fixed parameters are labelled 'Yes', and selectivities mirrored to another gear (fixed to that gear's estimate), are labelled as such. Dashes are non-applicable parameters for that model."))  %>% 
  column_spec(1, width = "8em")
```

\begin{landscapepage}
```{r bridge1-likelihoods, results = 'asis'}
likelihood_table(models$bridge_models[[1]],
                 model_col_widths = "5em",
                 font_size = 7,
                 format = "latex",
                 caption = "Negative log likelihoods included in the objective function for each model.")
```
\end{landscapepage}

\clearpage



