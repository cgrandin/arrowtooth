---
title: "Arrowtooth Flounder (*Atheresthes stomias*) Stock Assessment for the West Coast of British Columbia in 2021"
author: |
  Chris J. Grandin^1^ and
  Sean C. Anderson^1^
author_list: "Grandin, C.J. and Anderson, S.C."
address: |
  ^1^Pacific Biological Station\
     Fisheries and Oceans Canada, 3190 Hammond Bay Road\
     Nanaimo, British Columbia, V9T 6N7, Canada
month: October
year: 2021
report_number: nnn
region: Pacific Region
isbn: "978-0-660-38322-4"
citation_other_language: "Grandin, C.J. et Anderson, S.C. Title Here (*Latin Species Name*). DFO Secr. can. de consult. sci. du MPO. Doc. de rech 2019/nnn. iv + 13 p."
abstract: |
  Arrowtooth Flounder(*Atheresthes stomias*, Turbot) are an important component of the bottom trawl fishery in British Columbia. They are managed as a coastwide stock, with a TAC of 4,000 t and catch of 10,679 t in 2014. Prior to the introduction of freezer trawlers in the mid-2000s, most of the historical catch of Arrowtooth Flounder is understood to have been discarded at sea. This was largely due to proteolysis, which occurs in the muscle tissue of this species a short time after it is caught, making the flesh unpalatable. In the past decade, markets have been established for fillets that have been frozen at sea, and the freezer trawl fleet has taken an increasing proportion of the coastwide catch.

  This assessment fits a female-only Bayesian age-structured model to catch,survey and age-composition data from the years 1996-2019, for management areas 3CD (West Coast Vancouver Island), 5AB (Queen Charlotte Sound), 5CD (Hecate Strait), and 5E (West Coast Haida Gwaii). Catch data prior to the introduction of at-sea observers in 1996 were considered too unreliablefor inclusion in the assessment due to unknown quantities of discarding at sea.
  
  Management advice is provided in the form of decision tables which forecast the impacts of a range of 2020 catch levels on Arrowtooth Flounder stock status relative to these reference points. The Reference Case decision table suggests that a 2020 catch equal to any of the catch levels tested, ranging from 0 t to 30,000 t, would result in a 2021 biomass above all of the candidate biomass-based reference points tested, and 2020 harvest rate below the estimated UMSY. Large uncertainty in the assessment is, however emphasised. The magnitude of catch and discards prior to 1996 is a major source of uncertainty in this assessment that could provide critical information about the scale and productivity of this stock. Ageing of archived otoliths from the freezer trawl feet is a high priority recommendation.
  
header: "Draft working paper --- Do not cite or circulate" # or "" to omit
output:
 csasdown::resdoc_pdf:
   french: false
   copy_sty: true
   line_nums: true
   line_nums_mod: 1
   lot_lof: false
# ------------
# End of options to set
knit: bookdown::render_book
link-citations: true
bibliography: bib/refs.bib
csl: csl/csas.csl # or csl/csas-french.csl for French
# Any extra LaTeX code for the header:
# header-includes:
# - \usepackage{tikz}
---

```{r setup, echo=FALSE, cache=FALSE, message=FALSE, results='hide', warning=FALSE}
library(knitr)
if (is_latex_output()) {
  knitr_figs_dir <- "knitr-figs-pdf/"
  knitr_cache_dir <- "knitr-cache-pdf/"
  fig_out_type <- "png"
} else {
  knitr_figs_dir <- "knitr-figs-docx/"
  knitr_cache_dir <- "knitr-cache-docx/"
  fig_out_type <- "png"
}
fig_asp <- 0.618
fig_width <- 9
fig_out_width <- "6in"
fig_dpi <- 180
fig_align <- "center"
fig_pos <- "htb"
user <- Sys.getenv("USER")
opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  results = 'hide',
  comment = "#>",
  fig.path = knitr_figs_dir,
  cache.path = knitr_cache_dir,
  fig.asp = fig_asp,
  fig.width = fig_width,
  out.width = fig_out_width,
  echo = FALSE,
  autodep = isTRUE(user == "seananderson"),
  cache = isTRUE(user == "seananderson"),
  cache.comments = FALSE,
  dev = fig_out_type,
  dpi = fig_dpi,
  fig.align = fig_align,
  fig.pos = fig_pos
)
options(xtable.comment = FALSE)
options(kableExtra.latex.load_packages = FALSE)
```

```{r load-libraries, cache=FALSE}
# `french` and `prepub` variables are extracted from the YAML headers above and
#  are used throughout the document. To make the document all in french, change
#  the line in the YAML header above to `french: true`
meta <- rmarkdown::metadata$output
if (length(grep("pdf", names(meta)))) {
  french <- meta$`csasdown::resdoc_pdf`$french
  prepub <- meta$`csasdown::resdoc_pdf`$prepub
} else if (length(grep("word", names(meta)))) {
  french <- meta$`csasdown::resdoc_word`$french
  prepub <- meta$`csasdown::resdoc_word`$prepub
}
csl <- "csl/csas.csl"
if (french) {
  csl <- "csl/csas-french.csl"
  options(OutDec = ",")
}

library(csasdown)
library(gfiscamutils)
#library(gfplot)
library(ggplot2)
library(rosettafish)
library(tidylog, warn.conflicts = FALSE)
library(dplyr)
library(purrr)
library(here)
load_all("C:/github/pbs-assess/gfiscamutils/")
load_all()

# This is a vector of bridge models that will be plotted against each other.
# This must either be NULL or set to a vector of directories
bridge_models_dirs <- c("01-base",
                        "02-bridge-update-data-to-2014",
                        "03-bridge-update-data-to-2019",
                        "04-bridge-remove-hsmsa-survey",
                        "05-bridge-add-discard-cpue",
                        "06-bridge-convert-to-splitsex",
                        "07-bridge-fishing-year-feb21-feb20")

bridge_models_text <- c("2015 Base model",
                        "Update data to 2014",
                        "Update data to 2019",
                        "Remove HS MSA survey",
                        "Add Discard CPUE index",
                        "Convert model to split sex",
                        "Change fishing year to Feb 21 - Feb 20")
bridge_models_text <- factor(bridge_models_text, levels = bridge_models_text)

# This is a list of groups of sensitivities that will be plotted against each other.
# The base model will be prepended to each group later in set_dirs() so that it is first
# on the plots for each group.
# This must either be NULL or set to a list of vectors of directories
sens_models_dirs <- list(c("02-bridge-update-data",
                           "03-bridge-remove-hsmsa-survey"),
                         c("04-bridge-add-discard-cpue",
                           "05-bridge-convert-to-splitsex"),
                         "06-bridge-fishing-year-feb21-feb20")

if(here::here() == "/home/rstudio"){
  drs<- set_dirs(nongit_dir = file.path(dirname(here::here("arrowtooth")), "arrowtooth-nongit"),
                 base_model_dir = "base",
                 bridge_models_dirs = bridge_models_dirs,
                 sens_models_dirs = sens_models_dirs)
}else{
  drs <- set_dirs(base_model_dir = "base",
                  bridge_models_dirs = bridge_models_dirs,
                  sens_models_dirs = sens_models_dirs)
}

  # A list of lists of sensitivity groups. Any given sensitivity can appear in more than one group.
  # Do not include base model in this list or it will appear twice on plots
  # The base model name is prepended to each group with the map..append pipe at the end
  # sens_models_dirs <- list(
  #   c("02-sigma-0.1",
  #     "03-estimated-total-variance"),
  #   c("04-tau-1.0",
  #     "05-tau-0.6"),
  #   "06-low-steepness",
  #   c("07-m-0.2-sd-0.05",
  #     "08-m-0.2-sd-0.25"),
  #   "09-m-0.3-sd-0.2",
  #   "10-qm0-qsd1",
  #   "11-qm05-qsd15",
  #   c("12-fix-trawl-sel-amat",
  #     "13-fix-trawl-sel-6years")
  # )

models <- model_setup(main_dirs = drs,
                      bridge_models_text = bridge_models_text,
                      overwrite_rds_files = TRUE)

dat <- readRDS(file.path(drs$nongit_dir, "data", "arrowtooth-flounder-june11-2021.rds"))

survey_index <- dat$survey_index
survey_sets <- dat$survey_sets
survey_samples <- dat$survey_samples
commercial_samples <- dat$commercial_samples
catch <- dat$catch
cpue_spatial <- dat$cpue_spatial
cpue_spatial_ll <- dat$cpue_spatial_ll
age_precision <- dat$age_precision
#theme_set(herring_theme())
theme_set(theme_pbs())
```

---
csl: `r csl`    
---
